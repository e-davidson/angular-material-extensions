<ng-container [matColumnDef]="metaData.key">

  <ng-template #body let-element='element' >
    <mat-cell [styler]='metaData?.additional?.styles'  (click)='cellClicked(element, metaData.key)' >
      <ng-container [ngSwitch]="metaData.fieldType">
        <span *ngSwitchCase="FieldType.Boolean">
            <mat-icon *ngIf="element[metaData.key]">check</mat-icon>
        </span>
        <span *ngSwitchCase="FieldType.Link">
          <a *ngIf="metaData.additional.useRouterLink; else hrefLink" target="{{metaData.additional?.target || '_blank'}}" [routerLink]="[metaData.additional.base, metaData.additional.urlKey ? element[metaData.additional.urlKey] : element[metaData.key]]">
              {{element[metaData.key]}}
          </a>
          <ng-template #hrefLink>
            <a target="{{metaData.additional?.target || '_blank'}}" href="{{metaData.additional.base}}{{metaData.additional.urlKey? element[metaData.additional.urlKey] : element[metaData.key]}}">
                {{element[metaData.key]}}
            </a>
          </ng-template>
        </span>
        <span *ngSwitchCase="FieldType.ImageUrl">
            <img src="{{element[metaData.key]}}" height="75px" width="75px" />
        </span>
        <span *ngSwitchCase="FieldType.Currency" [class.negative-currency]="element[metaData.key] < 0">
            {{element[metaData.key] | currency }}
        </span>
        <tb-array-column *ngSwitchCase="FieldType.Array" [array]='element[metaData.key]' ></tb-array-column>
        <span *ngSwitchCase='FieldType.Expression'>{{element | func : transform }}</span>
        <span *ngSwitchDefault> {{ element[metaData.key] | func: transform  }} </span>
      </ng-container>
    <span class="no-val" *ngIf="metaData.fieldType !== FieldType.Expression && ( element[metaData.key]===null || element[metaData.key]===undefined)">-</span>
    </mat-cell>
  </ng-template>

  <ng-template #customCellWrapper let-element='element' >
    <mat-cell [styler]='metaData?.additional?.styles'  (click)='cellClicked(element, metaData.key)' >
      <ng-container *ngTemplateOutlet="customCell.TemplateRef ;context: {metaData: metaData, element: element }">
      </ng-container>
    </mat-cell>
  </ng-template>

  <ng-template matHeaderCellDef>

    <ng-container *ngIf="customCell?.columnDef?.headerCell;else header;">
      <ng-container *ngTemplateOutlet="customCell.columnDef.headerCell.template; context: {metaData: metaData } ">
      </ng-container>
    </ng-container>

    <ng-template #header>
      <mat-header-cell  [styler]='metaData?.additional?.styles' >
        <div class="header-container">
          <div *ngIf="!metaData._internalNotUserDefined || !customCell?.columnDef?.cell ; else headerWithoutMenu" mat-sort-header style="width: 100%">
            {{ metaData.displayName ?  metaData.displayName : (metaData.key | spaceCase ) }}
          </div>
          <ng-template #headerWithoutMenu >
            <div *ngIf="metaData._internalNotUserDefined;" style="width: 100%">
              {{ metaData.displayName ?  metaData.displayName : (metaData.key | spaceCase ) }}
            </div>
          </ng-template>

          <tb-header-menu *ngIf="(!metaData._internalNotUserDefined || !customCell?.columnDef?.cell) && (!metaData.noFilter)" #menu [metaData]='metaData' [filter]='filter' ></tb-header-menu>
        </div>
      </mat-header-cell>
    </ng-template>
  </ng-template>


  <ng-container *matCellDef="let element;">
      <ng-container *ngTemplateOutlet="template; context: {metaData: metaData, element: element }">
      </ng-container>
  </ng-container>

  <ng-template matFooterCellDef>
    <ng-container *ngIf="customCell?.columnDef?.footerCell;else footer">
      <ng-container
        *ngTemplateOutlet="customCell.columnDef.footerCell.template;context: {metaData: metaData, data: data$ }">
      </ng-container>
    </ng-container>
    <ng-template #footer>
      <mat-footer-cell  [styler]='metaData?.additional?.styles' >
        <span *ngIf="metaData.additional?.footer" [ngSwitch]="metaData.fieldType">
          <span *ngSwitchCase="FieldType.Currency">
            {{ data$ | columnTotal: metaData | async | currency }}
          </span>
        </span>
      </mat-footer-cell>
    </ng-template>
  </ng-template>
</ng-container>
