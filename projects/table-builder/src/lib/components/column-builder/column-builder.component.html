<ng-container [matColumnDef]="metaData.key">

  <ng-template matHeaderCellDef>

    <ng-container *ngIf="customCell?.columnDef?.headerCell;else header">
      <ng-container *ngTemplateOutlet="customCell.columnDef.headerCell.template; context: {metaData: metaData } ">
      </ng-container>
    </ng-container>
    <ng-template #header>
      <mat-header-cell class="f-mat-header-cell">
        <div style='display: flex;flex-direction: row; width: 100%; align-items: center;'>
          <div mat-sort-header style="width: 100%">
            {{ metaData.displayName ?  metaData.displayName : (metaData.key | spaceCase ) }}
          </div>
          <div *ngIf='displayFilter'>
            <div class="switch" [ngSwitch]="true">
              <div class="switch"
                *ngSwitchCase="metaData.fieldType === FieldType.String || metaData.fieldType === FieldType.Array || metaData.fieldType === FieldType.Unknown">
                <ng-container>
                  <mat-form-field appearance="outline">
                    <input matInput [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()" >
                  </mat-form-field>
                </ng-container>
              </div>
              <div class="switch"
                *ngSwitchCase="metaData.fieldType === FieldType.Number || metaData.fieldType === FieldType.Currency">
                <mat-form-field appearance="outline">
                  <input matInput type='number' [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()" >
                  <div matSuffix style='display: flex; flex-direction: row;'>
                    <mat-icon (dblclick)="setFilterType(FilterType.NumberGreaterThen)" [ngStyle]="{'color': filter.filterType === FilterType.NumberGreaterThen ? 'green' : ''  }" >arrow_forward_ios</mat-icon>
                    <mat-icon (dblclick)="setFilterType(FilterType.NumberLessThen)" [ngStyle]="{'color': filter.filterType === FilterType.NumberLessThen ? 'green' : ''  }">arrow_back_ios</mat-icon>
                  </div>
                </mat-form-field>
              </div>
              <div class="switch" *ngSwitchCase="FieldType.Boolean">

              </div>
              <div class="switch" *ngSwitchCase="FieldType.Date">

              </div>
            </div>

          </div>
          <button mat-icon-button disableRipple [matMenuTriggerFor]="menu" aria-label="Example icon-button with a menu" style="height:16px;" >
            <mat-icon class="menu-icon" >more_vert</mat-icon>
          </button>
          <mat-menu #menu="matMenu">
            <button mat-menu-item (click)=hideField(metaData.key)>
              <mat-icon>clear</mat-icon>
              <span>Hide</span>
            </button>
            <ng-container [ngSwitch]="true">
              <ng-container
                *ngSwitchCase="metaData.fieldType === FieldType.String || metaData.fieldType === FieldType.Array || metaData.fieldType === FieldType.Unknown">
                <mat-form-field  (click)="stopClickPropagate($event)" class="example-full-width font" style="padding: 0 16px">
                  <mat-icon matPrefix class="search-icon">search</mat-icon>
                  <input matInput placeholder="Filter" [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()" >
                </mat-form-field>
              </ng-container>
              <ng-container *ngSwitchCase="metaData.fieldType === FieldType.Number || metaData.fieldType === FieldType.Currency">
                <mat-form-field class="auto-width" (click)="stopClickPropagate($event)"  style="padding: 0 16px">
                  <mat-icon matPrefix class="search-icon">search</mat-icon>
                  <input matInput type='number' [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()" >
                  <span matSuffix  >
                      <button mat-icon-button disableRipple><mat-icon (dblclick)="setFilterType(FilterType.NumberGreaterThen)" class="suffix-icons" [ngStyle]="{'color': filter.filterType === FilterType.NumberGreaterThen ? 'green' : ''  }" >arrow_forward_ios</mat-icon></button>
                        <button mat-icon-button disableRipple><mat-icon (dblclick)="setFilterType(FilterType.NumberLessThen)" class="suffix-icons" [ngStyle]="{'color': filter.filterType === FilterType.NumberLessThen ? 'green' : ''  }">arrow_back_ios</mat-icon></button>
                  </span>
                </mat-form-field>
              </ng-container>
              <ng-container *ngSwitchCase="metaData.fieldType === FieldType.Boolean">
                <div style="padding: 0 16px">
                <label><mat-icon class="search-icon">filter_list</mat-icon> </label>
                <mat-radio-group class="font" (click)="stopClickPropagate($event)"  [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()">
                  <mat-radio-button class="filter-radio-button" [value]="null">Reset</mat-radio-button><br>
                  <mat-radio-button class="filter-radio-button" [value]="true">True</mat-radio-button><br>
                  <mat-radio-button class="filter-radio-button" [value]="false">False</mat-radio-button>
                </mat-radio-group>
                </div>
              </ng-container>
              <ng-container *ngSwitchCase="metaData.fieldType === FieldType.Date">
                  <mat-form-field style="padding: 0 16px" class="font auto-width" (click)="stopClickPropagate($event)" >
                      <span matPrefix>
                      <button mat-icon-button disableRipple><mat-icon (dblclick)="setFilterType(FilterType.DateOnOrAfter)" class="suffix-icons" [ngStyle]="{'color': filter.filterType === FilterType.DateOnOrAfter ? 'green' : ''  }" >arrow_forward_ios</mat-icon></button>
                      <button mat-icon-button disableRipple><mat-icon (dblclick)="setFilterType(FilterType.DateOnOrBefore)" class="suffix-icons" [ngStyle]="{'color': filter.filterType === FilterType.DateOnOrBefore ? 'green' : ''  }">arrow_back_ios</mat-icon></button>
                      </span>
                      <input matInput [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()" [matDatepicker]="calendar" (click)="calendar.open()">
                      <mat-datepicker-toggle matSuffix [for]="calendar"></mat-datepicker-toggle>
                      <mat-datepicker #calendar></mat-datepicker>
                  </mat-form-field>
              </ng-container>
            </ng-container>
          </mat-menu>
        </div>
      </mat-header-cell>
    </ng-template>
  </ng-template>


  <ng-container *matCellDef="let element">
    <ng-container *ngIf="customCell?.columnDef?.cell;else body">
      <ng-container
        *ngTemplateOutlet="customCell.columnDef.cell.template; context: {metaData: metaData, element: element }">
      </ng-container>
    </ng-container>
    <ng-template #body>
      <mat-cell>
        <ng-container
          *ngTemplateOutlet="customCell?.TemplateRef ? customCell.TemplateRef : body2 ;context: {metaData: metaData, element: element }">
        </ng-container>
        <ng-template #body2>
          <tb-val-displayer [col]="metaData" [element]="element"></tb-val-displayer>
        </ng-template>
      </mat-cell>
    </ng-template>
  </ng-container>

  <ng-template matFooterCellDef>
    <ng-container *ngIf="customCell?.columnDef?.footerCell;else footer">
      <ng-container
        *ngTemplateOutlet="customCell.columnDef.footerCell.template;context: {metaData: metaData, data: data$ }">
      </ng-container>
    </ng-container>
    <ng-template #footer>
      <mat-footer-cell>
        <span *ngIf="metaData.additional?.footer" [ngSwitch]="metaData.fieldType">
          <span *ngSwitchCase="FieldType.Currency">
            {{ data$ | async | columnTotal:metaData | async | currency }}
          </span>
        </span>
      </mat-footer-cell>
    </ng-template>
  </ng-template>

</ng-container>
<ng-container [matColumnDef]="(metaData.key + '_filter')">
    <ng-template matHeaderCellDef>
        <mat-header-cell class="f-mat-header-cell" >
        <div class="switch" [ngSwitch]="true">
          <div class="switch"
            *ngSwitchCase="metaData.fieldType === FieldType.String || metaData.fieldType === FieldType.Array || metaData.fieldType === FieldType.Unknown">
            <ng-container>
              <mat-form-field class="form-field" appearance="outline">
                <input matInput [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()"
                [placeholder]="'Filter ' + (metaData.displayName ?  metaData.displayName : (metaData.key | spaceCase ))">
              </mat-form-field>
            </ng-container>
          </div>
          <div class="switch"
            *ngSwitchCase="metaData.fieldType === FieldType.Number || metaData.fieldType === FieldType.Currency">
            <mat-form-field appearance="outline" class="form-field">
              <input matInput type='number' [(ngModel)]="filter.filterValue" (ngModelChange)="change$.emit()" >
              <div matSuffix style='display: flex; flex-direction: row;'>
                <button mat-icon-button disableRipple matTooltip="Less than" (dblclick)="setFilterType(FilterType.NumberLessThen)" [ngStyle]="{'color': filter.filterType === FilterType.NumberLessThen ? 'green' : ''  }"><mat-icon>arrow_back_ios</mat-icon></button>
                <button mat-icon-button disableRipple matTooltip="Greater than" (dblclick)="setFilterType(FilterType.NumberGreaterThen)" [ngStyle]="{'color': filter.filterType === FilterType.NumberGreaterThen ? 'green' : ''  }" ><mat-icon>arrow_forward_ios</mat-icon></button>
              </div>
            </mat-form-field>
          </div>
          <div class="switch" *ngSwitchCase="FieldType.Boolean">

          </div>
          <div class="switch" *ngSwitchCase="FieldType.Date">

          </div>
        </div>


        </mat-header-cell>
      </ng-template>
      <ng-container *matCellDef="let element">
        </ng-container>
</ng-container>
